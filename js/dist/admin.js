(()=>{var t={n:n=>{var a=n&&n.__esModule?()=>n.default:()=>n;return t.d(a,{a}),a},d:(n,a)=>{for(var e in a)t.o(a,e)&&!t.o(n,e)&&Object.defineProperty(n,e,{enumerable:!0,get:a[e]})},o:(t,n)=>Object.prototype.hasOwnProperty.call(t,n)};(()=>{"use strict";const n=flarum.core.compat["admin/app"];var a=t.n(n);function e(t,n){return e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},e(t,n)}function i(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,e(t,n)}const s=flarum.core.compat["admin/components/ExtensionPage"];var r=t.n(s);const o=flarum.core.compat["common/components/Button"];var l=t.n(o);const d=flarum.core.compat["common/components/LoadingIndicator"];var u=t.n(d);const c=flarum.core.compat["common/Component"];var h=t.n(c);const f=flarum.core.compat["common/components/Modal"];var p=t.n(f),g=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var a=n.prototype;return a.oninit=function(n){t.prototype.oninit.call(this,n),this.brand=this.attrs.brand,this.newName=this.brand.attributes.name||""},a.className=function(){return"EditBrandModal Modal--small"},a.title=function(){return"Edit Brand"},a.content=function(){var t=this;return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",null,"Brand Name"),m("input",{className:"FormControl",type:"text",value:this.newName,oninput:function(n){return t.newName=n.target.value}})),m("div",{className:"Form-group"},m(l(),{className:"Button Button--primary",type:"submit",onclick:function(){t.attrs.onsubmit(t.newName),t.hide()}},"Save Changes"))))},n}(p()),y=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var a=n.prototype;return a.oninit=function(n){t.prototype.oninit.call(this,n),this.brand=this.attrs.brand},a.className=function(){return"DeleteBrandModal Modal--small"},a.title=function(){return"Confirm Deletion"},a.content=function(){var t=this;return m("div",{className:"Modal-body"},m("p",null,'Are you sure you want to delete the brand "',this.brand.attributes.name,'"? This will also delete all associated models, years, configs, and links.'),m("div",{className:"Form-group"},m(l(),{className:"Button Button--primary Button--danger",onclick:function(){t.attrs.onconfirm(),t.hide()}},"Delete")," ",m(l(),{className:"Button",onclick:function(){return t.hide()}},"Cancel")))},n}(p()),b=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var e=n.prototype;return e.oninit=function(n){t.prototype.oninit.call(this,n),this.brandId=this.attrs.brandId,this.models=[],this.loading=!0,this.newModel="",this.loadModels()},e.loadModels=function(){var t=this;this.loading=!0,a().request({method:"GET",url:a().forum.attribute("apiUrl")+"/canbus/models",params:{filter:{brand_id:this.brandId}}}).then((function(n){t.models=n.data,t.loading=!1,m.redraw()})).catch((function(n){t.loading=!1,m.redraw(),alert("Error loading models: "+n)}))},e.view=function(){var t=this;return m("div",{className:"ModelList"},m("h3",null,"Car Models"),m("div",{className:"CanBusForm"},m("div",{className:"form-group"},m("label",null,"Add New Model"),m("input",{type:"text",className:"FormControl",value:this.newModel,oninput:function(n){return t.newModel=n.target.value},placeholder:"Enter model name"})),l().component({className:"Button Button--primary",disabled:this.loading,onclick:function(){return t.saveModel()}},"Add Model")),this.loading?m(u(),null):m("table",{className:"CanBusTable"},m("thead",null,m("tr",null,m("th",null,a().translator.trans("ltydi-canbus-settings.admin.models.model_name")),m("th",{className:"actions"},a().translator.trans("ltydi-canbus-settings.admin.common.actions")))),m("tbody",null,this.models.map((function(n){return m("tr",{key:n.id},m("td",null,n.attributes.name),m("td",{className:"actions"},l().component({className:"Button Button--icon",icon:"fas fa-edit",onclick:function(){return t.editModel(n)},title:a().translator.trans("ltydi-canbus-settings.admin.common.edit_title")}),l().component({className:"Button Button--icon",icon:"fas fa-trash",onclick:function(){return t.deleteModel(n)},title:a().translator.trans("ltydi-canbus-settings.admin.common.delete_title")}),l().component({className:"Button Button--icon",icon:"fas fa-arrow-right",onclick:function(){return t.attrs.onSelect(n)},title:a().translator.trans("ltydi-canbus-settings.admin.models.view_years_title")})))})),0===this.models.length&&m("tr",null,m("td",{colSpan:"2",className:"text-center"},a().translator.trans("ltydi-canbus-settings.admin.models.no_models"))))))},e.saveModel=function(){var t=this;if(this.newModel.trim()){var n=this.newModel.trim();this.loading=!0;var e=a().forum.attribute("apiUrl")+"/canbus/models?name="+encodeURIComponent(n)+"&brand_id="+encodeURIComponent(this.brandId);console.log("Adding model:",n,"for brand ID:",this.brandId),a().request({method:"POST",url:e}).then((function(n){t.models.push(n.data),t.newModel="",t.loading=!1,m.redraw()})).catch((function(n){console.error("Error adding model:",n),a().request({method:"POST",url:a().forum.attribute("apiUrl")+"/canbus/models"}).then((function(n){t.models.push(n.data),t.newModel="",t.loading=!1,m.redraw()})).catch((function(a){console.error("Second attempt failed:",a),t.loading=!1,m.redraw(),alert("Error adding model: "+(n.response&&n.response.errors?n.response.errors[0].detail:n))}))}))}else alert("Model name cannot be empty")},e.editModel=function(t){var n=this;a().modal.show(v,{model:t,onsubmit:function(e){if(e&&e!==t.attributes.name){n.loading=!0;var i={data:{type:"canbus-models",id:t.id,attributes:{name:e.trim()}}};a().request({method:"PATCH",url:a().forum.attribute("apiUrl")+"/canbus/models/"+t.id,body:i}).then((function(i){var s=n.models.findIndex((function(n){return n.id===t.id}));-1!==s&&(n.models[s]=i.data),n.loading=!1,m.redraw(),n.loadModels(!0),a().alerts.show({type:"success"},"Model updated successfully to: "+e.trim())})).catch((function(t){var a;console.error("Error updating model:",t),console.error("Response:",t.response),n.loading=!1,m.redraw(),alert("Error updating model: "+((null==(a=t.response)||null==(a=a.errors)||null==(a=a[0])?void 0:a.detail)||t))}))}}})},e.deleteModel=function(t){var n=this;a().modal.show(N,{model:t,onconfirm:function(){n.loading=!0,console.log("Deleting model with ID:",t.id),console.log("Request URL:",a().forum.attribute("apiUrl")+"/canbus/models/"+t.id),console.log("Request method: DELETE"),a().request({method:"DELETE",url:a().forum.attribute("apiUrl")+"/canbus/models/"+t.id}).then((function(){console.log("Model deleted successfully"),n.models=n.models.filter((function(n){return n.id!==t.id})),n.loading=!1,m.redraw()})).catch((function(t){var a;console.error("Error deleting model:",t),console.error("Response:",t.response),n.loading=!1,m.redraw(),alert("Error deleting model: "+((null==(a=t.response)||null==(a=a.errors)||null==(a=a[0])?void 0:a.detail)||t))}))}})},n}(h()),v=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var a=n.prototype;return a.oninit=function(n){t.prototype.oninit.call(this,n),this.model=this.attrs.model,this.newName=this.model.attributes.name||""},a.className=function(){return"EditModelModal Modal--small"},a.title=function(){return"Edit Model"},a.content=function(){var t=this;return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",null,"Model Name"),m("input",{className:"FormControl",type:"text",value:this.newName,oninput:function(n){return t.newName=n.target.value}})),m("div",{className:"Form-group"},m(l(),{className:"Button Button--primary",type:"submit",onclick:function(){t.attrs.onsubmit(t.newName),t.hide()}},"Save Changes"))))},n}(p()),N=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var a=n.prototype;return a.oninit=function(n){t.prototype.oninit.call(this,n),this.model=this.attrs.model},a.className=function(){return"DeleteModelModal Modal--small"},a.title=function(){return"Confirm Deletion"},a.content=function(){var t=this;return m("div",{className:"Modal-body"},m("p",null,'Are you sure you want to delete the model "',this.model.attributes.name,'"? This will also delete all associated years, configs and links.'),m("div",{className:"Form-group"},m(l(),{className:"Button Button--primary Button--danger",onclick:function(){t.attrs.onconfirm(),t.hide()}},"Delete")," ",m(l(),{className:"Button",onclick:function(){return t.hide()}},"Cancel")))},n}(p());jQuery;var w=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var e=n.prototype;return e.oninit=function(n){t.prototype.oninit.call(this,n),this.modelId=this.attrs.modelId,this.years=[],this.loading=!0,this.newYearRange="",this.editingYearId=null,this.editYearRange="",this.loadYears()},e.onupdate=function(t){this.modelId!==this.attrs.modelId&&(this.modelId=this.attrs.modelId,this.years=[],this.loading=!0,this.loadYears())},e.loadYears=function(t){var n=this;if(void 0===t&&(t=!1),!this.modelId)return this.years=[],this.loading=!1,void m.redraw();this.loading=!0;var e=a().forum.attribute("apiUrl")+"/canbus/years",i={"filter[model_id]":this.modelId};t&&(i._nocache=(new Date).getTime()),a().request({method:"GET",url:e,params:i,headers:t?{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}:{}}).then((function(t){n.years=t.data||[],n.loading=!1,m.redraw()})).catch((function(t){n.years=[],n.loading=!1,m.redraw()}))},e.view=function(){var t=this;return this.modelId?m("div",{className:"YearList"},m("h3",null,"Year Ranges"),m("div",{className:"CanBusForm"},m("div",{className:"form-group"},m("label",null,"Add New Year Range"),m("input",{type:"text",className:"FormControl",value:this.newYearRange,oninput:function(n){return t.newYearRange=n.target.value},placeholder:"e.g. 2010-2015"})),m(l(),{className:"Button Button--primary",disabled:this.loading,onclick:function(){return t.saveYear()}},"Add Year Range")),this.loading?m(u(),null):m("table",{className:"CanBusTable"},m("thead",null,m("tr",null,m("th",null,a().translator.trans("ltydi-canbus-settings.admin.years.year_range")),m("th",{className:"actions"},a().translator.trans("ltydi-canbus-settings.admin.common.actions")))),m("tbody",null,this.years.map((function(n){return m("tr",{key:n.id},m("td",null,n.attributes.year_range),m("td",{className:"actions"},l().component({className:"Button Button--icon",icon:"fas fa-edit",onclick:function(){return t.editYear(n)},title:a().translator.trans("ltydi-canbus-settings.admin.common.edit_title")}),l().component({className:"Button Button--icon",icon:"fas fa-trash",onclick:function(){return t.deleteYear(n)},title:a().translator.trans("ltydi-canbus-settings.admin.common.delete_title")}),l().component({className:"Button Button--icon",icon:"fas fa-arrow-right",onclick:function(){return t.attrs.onSelect(n)},title:a().translator.trans("ltydi-canbus-settings.admin.years.view_configs_title")})))})),0===this.years.length&&m("tr",null,m("td",{colSpan:"2",className:"text-center"},a().translator.trans("ltydi-canbus-settings.admin.years.no_years")))))):m("div",{className:"YearList"},m("p",null,"Please select a model first."))},e.saveYear=function(){var t=this;if(this.newYearRange&&this.newYearRange.trim()){this.loading=!0;var n={data:{type:"canbus-years",attributes:{year_range:this.newYearRange.trim()},relationships:{model:{data:{type:"canbus-models",id:this.modelId}}}}};a().request({method:"POST",url:a().forum.attribute("apiUrl")+"/canbus/years",body:n}).then((function(n){t.years.push(n.data),t.newYearRange="",t.loading=!1,m.redraw()})).catch((function(n){var a;t.loading=!1,m.redraw(),alert("Error adding year: "+((null==(a=n.response)||null==(a=a.errors)||null==(a=a[0])?void 0:a.detail)||n))}))}},e.deleteYear=function(t){var n=this;a().modal.show(B,{year:t,onconfirm:function(){n.loading=!0,a().request({method:"DELETE",url:a().forum.attribute("apiUrl")+"/canbus/years/"+t.id}).then((function(){n.years=n.years.filter((function(n){return n.id!==t.id})),n.loading=!1,m.redraw()})).catch((function(t){n.loading=!1,m.redraw(),alert("Error deleting year: "+t)}))}})},e.editYear=function(t){var n=this;a().modal.show(k,{year:t,onsubmit:function(e){if(e&&e!==t.attributes.year_range){n.loading=!0;var i={data:{type:"canbus-years",id:t.id,attributes:{year_range:e.trim()}}};if(!t.id)return alert("Error: Year ID cannot be empty"),n.loading=!1,void m.redraw();a().request({method:"PATCH",url:a().forum.attribute("apiUrl")+"/canbus/years/"+t.id,body:i}).then((function(i){var s=n.years.findIndex((function(n){return n.id===t.id}));-1!==s&&(n.years[s]=i.data),n.loading=!1,m.redraw(),n.loadYears(!0),a().alerts.show({type:"success"},"Year range updated successfully to: "+e.trim())})).catch((function(t){var a;n.loading=!1,m.redraw(),alert("Error updating year: "+((null==(a=t.response)||null==(a=a.errors)||null==(a=a[0])?void 0:a.detail)||t))}))}}})},n}(h()),k=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var a=n.prototype;return a.oninit=function(n){t.prototype.oninit.call(this,n),this.year=this.attrs.year,this.newYearRange=this.year.attributes.year_range||""},a.className=function(){return"EditYearModal Modal--small"},a.title=function(){return"Edit Year Range"},a.content=function(){var t=this;return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",null,"Year Range"),m("input",{className:"FormControl",type:"text",value:this.newYearRange,oninput:function(n){return t.newYearRange=n.target.value},placeholder:"e.g. 2010-2015"})),m("div",{className:"Form-group"},m(l(),{className:"Button Button--primary",type:"submit",onclick:function(){t.attrs.onsubmit(t.newYearRange),t.hide()}},"Save Changes"))))},n}(p()),B=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var a=n.prototype;return a.oninit=function(n){t.prototype.oninit.call(this,n),this.year=this.attrs.year},a.className=function(){return"DeleteYearModal Modal--small"},a.title=function(){return"Confirm Deletion"},a.content=function(){var t=this;return m("div",{className:"Modal-body"},m("p",null,'Are you sure you want to delete the year range "',this.year.attributes.year_range,'"? This will also delete all associated configs and links.'),m("div",{className:"Form-group"},m(l(),{className:"Button Button--primary Button--danger",onclick:function(){t.attrs.onconfirm(),t.hide()}},"Delete")," ",m(l(),{className:"Button",onclick:function(){return t.hide()}},"Cancel")))},n}(p()),C=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var e=n.prototype;return e.oninit=function(n){t.prototype.oninit.call(this,n),this.yearId=this.attrs.yearId,this.configs=[],this.loading=!0,this.newConfigName="",this.loadConfigs()},e.loadConfigs=function(t){var n=this;if(void 0===t&&(t=!1),!this.yearId)return this.configs=[],this.loading=!1,void m.redraw();this.loading=!0,a().request({method:"GET",url:a().forum.attribute("apiUrl")+"/canbus/configs",params:{"filter[year_id]":this.yearId}}).then((function(a){n.configs=a.data||[],n.loading=!1,m.redraw(),t&&n.loadConfigs(!1)})).catch((function(t){n.configs=[],n.loading=!1,m.redraw()}))},e.view=function(){var t=this;return this.yearId?m("div",{className:"ConfigList"},m("h3",null,"Configuration List"),m("div",{className:"CanBusForm"},m("div",{className:"form-group"},m("label",null,"Add New Configuration"),m("input",{type:"text",className:"FormControl",value:this.newConfigName,oninput:function(n){return t.newConfigName=n.target.value},placeholder:"e.g. Manual AC"})),m(l(),{className:"Button Button--primary",disabled:this.loading,onclick:function(){return t.saveConfig()}},"Add Configuration")),this.loading?m(u(),null):m("table",{className:"CanBusTable"},m("thead",null,m("tr",null,m("th",null,a().translator.trans("ltydi-canbus-settings.admin.configs.config_name")),m("th",{className:"actions"},a().translator.trans("ltydi-canbus-settings.admin.common.actions")))),m("tbody",null,this.configs.map((function(n){return m("tr",{key:n.id},m("td",null,n.attributes.name),m("td",{className:"actions"},l().component({className:"Button Button--icon",icon:"fas fa-edit",onclick:function(){return t.editConfig(n)},title:a().translator.trans("ltydi-canbus-settings.admin.common.edit_title")}),l().component({className:"Button Button--icon",icon:"fas fa-trash",onclick:function(){return t.deleteConfig(n)},title:a().translator.trans("ltydi-canbus-settings.admin.common.delete_title")}),l().component({className:"Button Button--icon",icon:"fas fa-arrow-right",onclick:function(){return t.attrs.onSelect(n)},title:a().translator.trans("ltydi-canbus-settings.admin.configs.view_links_title")})))})),0===this.configs.length&&m("tr",null,m("td",{colSpan:"2",className:"text-center"},a().translator.trans("ltydi-canbus-settings.admin.configs.no_configs")))))):m("div",{className:"ConfigList"},m("p",null,"Please select a year first."))},e.saveConfig=function(){var t=this;if(this.newConfigName&&this.newConfigName.trim()){this.loading=!0;var n={data:{type:"canbus-configs",attributes:{name:this.newConfigName.trim()},relationships:{year:{data:{type:"canbus-years",id:this.yearId}}}}};a().request({method:"POST",url:a().forum.attribute("apiUrl")+"/canbus/configs",body:n}).then((function(n){t.configs.push(n.data),t.newConfigName="",t.loading=!1,m.redraw()})).catch((function(n){var a;t.loading=!1,m.redraw(),alert("Error adding configuration: "+((null==(a=n.response)||null==(a=a.errors)||null==(a=a[0])?void 0:a.detail)||n))}))}},e.editConfig=function(t){var n=this;a().modal.show(x,{config:t,onsubmit:function(e){if(e&&e!==t.attributes.name){n.loading=!0;var i={data:{type:"canbus-configs",id:t.id,attributes:{name:e.trim()}}};a().request({method:"PATCH",url:a().forum.attribute("apiUrl")+"/canbus/configs/"+t.id,body:i}).then((function(i){var s=n.configs.findIndex((function(n){return n.id===t.id}));-1!==s&&(n.configs[s]=i.data),n.loading=!1,m.redraw(),n.loadConfigs(!0),a().alerts.show({type:"success"},"Configuration updated successfully to: "+e.trim())})).catch((function(t){var a;n.loading=!1,m.redraw(),alert("Error updating configuration: "+((null==(a=t.response)||null==(a=a.errors)||null==(a=a[0])?void 0:a.detail)||t))}))}}})},e.deleteConfig=function(t){var n=this;a().modal.show(T,{config:t,onconfirm:function(){n.loading=!0,a().request({method:"DELETE",url:a().forum.attribute("apiUrl")+"/canbus/configs/"+t.id}).then((function(){n.configs=n.configs.filter((function(n){return n.id!==t.id})),n.loading=!1,m.redraw()})).catch((function(t){var a;n.loading=!1,m.redraw(),alert("Error deleting configuration: "+((null==(a=t.response)||null==(a=a.errors)||null==(a=a[0])?void 0:a.detail)||t))}))}})},n}(h()),x=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var a=n.prototype;return a.oninit=function(n){t.prototype.oninit.call(this,n),this.config=this.attrs.config,this.newName=this.config.attributes.name||""},a.className=function(){return"EditConfigModal Modal--small"},a.title=function(){return"Edit Configuration"},a.content=function(){var t=this;return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",null,"Configuration Name"),m("input",{className:"FormControl",type:"text",value:this.newName,oninput:function(n){return t.newName=n.target.value}})),m("div",{className:"Form-group"},m(l(),{className:"Button Button--primary",type:"submit",onclick:function(){t.attrs.onsubmit(t.newName),t.hide()}},"Save Changes"))))},n}(p()),T=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var a=n.prototype;return a.oninit=function(n){t.prototype.oninit.call(this,n),this.config=this.attrs.config},a.className=function(){return"DeleteConfigModal Modal--small"},a.title=function(){return"Confirm Deletion"},a.content=function(){var t=this;return m("div",{className:"Modal-body"},m("p",null,'Are you sure you want to delete the configuration "',this.config.attributes.name,'"? This will also delete all associated links.'),m("div",{className:"Form-group"},m(l(),{className:"Button Button--primary Button--danger",onclick:function(){t.attrs.onconfirm(),t.hide()}},"Delete")," ",m(l(),{className:"Button",onclick:function(){return t.hide()}},"Cancel")))},n}(p()),I=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var e=n.prototype;return e.oninit=function(n){var a=this;t.prototype.oninit.call(this,n);try{if(console.log("LinkList initializing with attrs:",n.attrs),this.configId=n.attrs?n.attrs.configId:null,console.log("Extracted configId:",this.configId),this.links=[],this.loading=!0,this.newLink="",this.newLinkDescription="",!this.configId)return console.error("ConfigId is missing or invalid:",this.configId,", cannot load links"),void(this.loading=!1);setTimeout((function(){try{a.loadLinks()}catch(t){console.error("Error in delayed loadLinks:",t),a.loading=!1,m.redraw()}}),100)}catch(t){console.error("Error in LinkList initialization:",t),this.loading=!1}},e.loadLinks=function(){var t=this;try{if(!this.configId)return console.error("Attempting to load links but configId is missing"),this.links=[],this.loading=!1,void m.redraw();this.loading=!0,console.log("Loading links for config ID:",this.configId),a().request({method:"GET",url:a().forum.attribute("apiUrl")+"/canbus/links",params:{"filter[config_id]":this.configId}}).then((function(n){console.log("Loaded links:",n),n&&n.data?t.links=Array.isArray(n.data)?n.data:[]:(console.warn("Response missing data property:",n),t.links=[]),t.loading=!1,m.redraw()})).catch((function(n){console.error("Error loading links:",n),console.error("Response:",n.response),t.links=[],t.loading=!1,m.redraw()}))}catch(t){console.error("Unexpected error in loadLinks:",t),this.links=[],this.loading=!1,m.redraw()}},e.view=function(){var t=this;try{if(!this.configId)return m("div",{className:"LinkList"},m("h3",null,"Link List"),m("div",{className:"CanBusNoLink"},m("p",null,"No configuration selected. Please choose a configuration first.")));var n=this.links&&Array.isArray(this.links)&&this.links.length>0;return m("div",{className:"LinkList"},m("h3",null,"Link List"),!n&&!this.loading&&m("div",{className:"CanBusForm"},m("div",{className:"form-group"},m("label",null,"Add Link"),m("input",{type:"text",className:"FormControl",value:this.newLink,oninput:function(n){return t.newLink=n.target.value},placeholder:"https://example.com/canbus-link"}),m("label",{style:{marginTop:"10px"}},"Link Description"),m("textarea",{className:"FormControl",value:this.newLinkDescription||"",oninput:function(n){return t.newLinkDescription=n.target.value},placeholder:"Optional: Add a description for this link",rows:"3"})),m(l(),{className:"Button Button--primary",disabled:this.loading,onclick:function(){return t.saveLink()}},"Add Link")),this.loading?m(u(),null):m("table",{className:"CanBusTable"},m("thead",null,m("tr",null,m("th",null,a().translator.trans("ltydi-canbus-settings.admin.links.link_url")),m("th",{className:"actions"},a().translator.trans("ltydi-canbus-settings.admin.common.actions")))),m("tbody",null,this.links&&this.links.map((function(n){return n&&n.attributes?m("tr",{key:n.id},m("td",null,[m("div",{className:"link-url"},m("a",{href:n.attributes.url,target:"_blank",rel:"noopener noreferrer"},n.attributes.url)),n.attributes.description&&m("div",{className:"LinkDescription",style:{marginTop:"5px",fontSize:"0.9em",color:"#666"}},n.attributes.description)]),m("td",{className:"actions"},l().component({className:"Button Button--icon",icon:"fas fa-edit",onclick:function(){return t.editLink(n)},title:a().translator.trans("ltydi-canbus-settings.admin.common.edit_title")}),l().component({className:"Button Button--icon",icon:"fas fa-trash",onclick:function(){return t.deleteLink(n)},title:a().translator.trans("ltydi-canbus-settings.admin.common.delete_title")}))):(console.error("Invalid link data:",n),null)})),(!this.links||0===this.links.length)&&m("tr",null,m("td",{colSpan:"2",className:"text-center"},a().translator.trans("ltydi-canbus-settings.admin.links.no_links"))))))}catch(t){return console.error("Error in LinkList view:",t),m("div",{className:"LinkList"},m("h3",null,"Link List"),m("div",{className:"CanBusError"},m("p",null,"An error occurred while displaying links. Please try again or contact support."),m("p",{className:"ErrorDetails"},t.message)))}},e.saveLink=function(){var t=this;if(this.newLink&&this.newLink.trim())if(this.links.length>0)alert("Each configuration can only have one link.");else{this.loading=!0,console.log("Adding new link for config ID:",this.configId);var n={data:{type:"canbus-links",attributes:{url:this.newLink.trim(),description:this.newLinkDescription?this.newLinkDescription.trim():""},relationships:{config:{data:{type:"canbus-configs",id:this.configId}}}}};console.log("Request data:",n),a().request({method:"POST",url:a().forum.attribute("apiUrl")+"/canbus/links",body:n}).then((function(n){console.log("Link added successfully:",n),t.links.push(n.data),t.newLink="",t.newLinkDescription="",t.loading=!1,t.attrs.onUpdate&&t.attrs.onUpdate({action:"add",configId:t.configId}),m.redraw()})).catch((function(a){var e;console.error("Error adding link:",a),console.error("Request data:",n),console.error("Response:",a.response),t.loading=!1,m.redraw(),alert("Error adding link: "+((null==(e=a.response)||null==(e=e.errors)||null==(e=e[0])?void 0:e.detail)||a))}))}},e.editLink=function(t){var n=this;t&&t.attributes?a().modal.show(L,{link:t,onsubmit:function(e,i){if(e&&(e!==t.attributes.url||i!==t.attributes.description)){n.loading=!0;var s={data:{type:"canbus-links",id:t.id,attributes:{url:e.trim(),description:i?i.trim():""}}};a().request({method:"PATCH",url:a().forum.attribute("apiUrl")+"/canbus/links/"+t.id,body:s}).then((function(a){var e=n.links.findIndex((function(n){return n.id===t.id}));-1!==e&&(n.links[e]=a.data),n.loading=!1,n.attrs.onUpdate&&n.attrs.onUpdate({action:"edit",configId:n.configId}),m.redraw()})).catch((function(t){var a;n.loading=!1,m.redraw(),alert("Error updating link: "+((null==(a=t.response)||null==(a=a.errors)||null==(a=a[0])?void 0:a.detail)||t))}))}}}):console.error("Link object or attributes are undefined")},e.deleteLink=function(t){var n=this;a().modal.show(E,{onconfirm:function(){n.loading=!0,a().request({method:"DELETE",url:a().forum.attribute("apiUrl")+"/canbus/links/"+t.id}).then((function(){n.links=n.links.filter((function(n){return n.id!==t.id})),n.loading=!1,n.attrs.onUpdate&&n.attrs.onUpdate({action:"delete",configId:n.configId}),m.redraw()})).catch((function(t){var a;n.loading=!1,m.redraw(),alert("Error deleting link: "+((null==(a=t.response)||null==(a=a.errors)||null==(a=a[0])?void 0:a.detail)||t))}))}})},n}(h()),L=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var a=n.prototype;return a.oninit=function(n){t.prototype.oninit.call(this,n),this.link=this.attrs.link,this.url=this.link.attributes.url||"",this.description=this.link.attributes.description||""},a.className=function(){return"EditLinkModal Modal--small"},a.title=function(){return"Edit Link"},a.content=function(){var t=this;return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",null,"Link URL"),m("input",{className:"FormControl",type:"text",value:this.url,oninput:function(n){return t.url=n.target.value}})),m("div",{className:"Form-group"},m("label",null,"Link Description (Optional)"),m("textarea",{className:"FormControl",value:this.description,oninput:function(n){return t.description=n.target.value},rows:"3"})),m("div",{className:"Form-group"},m(l(),{className:"Button Button--primary",type:"submit",onclick:function(){t.attrs.onsubmit(t.url,t.description),t.hide()}},"Save Changes"))))},n}(p()),E=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var a=n.prototype;return a.className=function(){return"DeleteConfirmModal Modal--small"},a.title=function(){return"Confirm Deletion"},a.content=function(){var t=this;return m("div",{className:"Modal-body"},m("p",null,"Are you sure you want to delete this link?"),m("div",{className:"Form-group"},m(l(),{className:"Button Button--primary Button--danger",onclick:function(){t.attrs.onconfirm(),t.hide()}},"Delete")," ",m(l(),{className:"Button",onclick:function(){return t.hide()}},"Cancel")))},n}(p()),M=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var e=n.prototype;return e.refreshSettings=function(){return a().request({method:"POST",url:a().forum.attribute("apiUrl")+"/settings",body:{data:[{type:"settings",id:"ltydi-canbus-settings.promptText"},{type:"settings",id:"ltydi-canbus-settings.displayName"}]}}).then((function(t){return t&&t.data&&t.data.forEach((function(t){"ltydi-canbus-settings.promptText"===t.id&&(a().data.settings||(a().data.settings={}),a().data.settings["ltydi-canbus-settings.promptText"]=t.attributes.value,a().forum&&a().forum.data&&a().forum.data.attributes&&(a().forum.data.attributes["canbus.promptText"]=t.attributes.value)),"ltydi-canbus-settings.displayName"===t.id&&(a().data.settings||(a().data.settings={}),a().data.settings["ltydi-canbus-settings.displayName"]=t.attributes.value,a().forum&&a().forum.data&&a().forum.data.attributes&&(a().forum.data.attributes["canbus.displayName"]=t.attributes.value))})),t})).catch((function(t){try{var n=localStorage.getItem("canbus-settings-promptText");n&&(a().data.settings||(a().data.settings={}),a().data.settings["ltydi-canbus-settings.promptText"]=n);var e=localStorage.getItem("canbus-settings-displayName");e&&(a().data.settings||(a().data.settings={}),a().data.settings["ltydi-canbus-settings.displayName"]=e)}catch(t){}return{data:[]}}))},e.oninit=function(n){var e=this;t.prototype.oninit.call(this,n),this.loading=!0,this.section="brands",this.hierarchy=[],this.promptText="",this.displayName="CanBus Settings";try{var i=localStorage.getItem("canbus-settings-promptText");i&&(this.promptText=i);var s=localStorage.getItem("canbus-settings-displayName");s&&(this.displayName=s)}catch(t){}this.refreshSettings().then((function(){a().forum&&a().forum.attribute("canbus.promptText")?e.promptText=a().forum.attribute("canbus.promptText"):a().data&&a().data.settings&&a().data.settings["ltydi-canbus-settings.promptText"]&&(e.promptText=a().data.settings["ltydi-canbus-settings.promptText"]),a().forum&&a().forum.attribute("canbus.displayName")?e.displayName=a().forum.attribute("canbus.displayName"):a().data&&a().data.settings&&a().data.settings["ltydi-canbus-settings.displayName"]&&(e.displayName=a().data.settings["ltydi-canbus-settings.displayName"])})),this.loadBrands()},e.loadBrands=function(){var t=this;this.loading=!0,a().request({method:"GET",url:a().forum.attribute("apiUrl")+"/canbus/brands"}).then((function(n){t.brands=n.data||[],t.loading=!1,m.redraw()})).catch((function(n){t.brands=[],t.loading=!1,m.redraw()}))},e.content=function(){var t=this;return m("div",{className:"ExtensionPage-settings CanBusSettingsPage",style:{maxWidth:"none",margin:"0",width:"100%"}},m("div",{className:"container",style:{maxWidth:"none",padding:"0 20px",width:"100%",boxSizing:"border-box"}},m("div",{className:"Form-group",style:{width:"100%"}},m("label",null,"Display Name"),m("div",{className:"helpText"},"Customize the display name for CanBus Settings that appears in navigation and page titles."),m("input",{id:"canbus-displayName-input",className:"FormControl",type:"text",value:this.displayName,oninput:function(n){return t.displayName=n.target.value},placeholder:"CanBus Settings",style:{width:"100%",maxWidth:"none",boxSizing:"border-box"}}),m("p",{className:"helpText",style:{marginTop:"5px"}},m("i",{className:"fas fa-info-circle",style:{marginRight:"5px"}}),"This name will be displayed in the forum navigation and page titles.")),m("div",{className:"Form-group",style:{width:"100%"}},m("label",null,"CanBus Message"),m("div",{className:"helpText"},"Customize the CanBus message that appears at the top of the settings page."),m("input",{id:"canbus-promptText-input",className:"FormControl",type:"text",value:this.promptText,oninput:function(n){return t.promptText=n.target.value},placeholder:"Welcome to the CanBus configuration page. Please select your vehicle details to find the appropriate settings.",style:{width:"100%",maxWidth:"none",boxSizing:"border-box"}}),m("p",{className:"helpText",style:{marginTop:"5px"}},m("i",{className:"fas fa-info-circle",style:{marginRight:"5px"}}),"This CanBus message helps guide users through the configuration process."),m("div",{className:"Form-group Form--controls"},l().component({type:"submit",className:"Button Button--primary",loading:this.loading,onclick:this.saveSettings.bind(this)},"Save Changes"))),m("div",{className:"FormSectionGroup",style:{width:"100%"}},m("div",{className:"FormSection"},m("label",null,"Vehicle Database"),m("p",{className:"helpText"},"Organize and manage vehicle information and configurations"),m("div",{className:"CanBusInstructions",style:{width:"100%"}},m("div",{className:"CanBusInstructions-header"},m("i",{className:"fas fa-info-circle"})," Database Management Guide"),m("div",{className:"CanBusInstructions-content"},m("p",null,"Follow these steps to manage vehicle configurations:"),m("ol",null,m("li",null,m("strong",null,"Brands:")," Add vehicle manufacturers"),m("li",null,m("strong",null,"Models:")," Add vehicle models using the ",m("i",{className:"fas fa-arrow-right"})," icon"),m("li",null,m("strong",null,"Years:")," Specify model years using the ",m("i",{className:"fas fa-arrow-right"})," icon"),m("li",null,m("strong",null,"Configurations:")," Add specific configurations using the ",m("i",{className:"fas fa-arrow-right"})," icon"),m("li",null,m("strong",null,"Settings:")," Add configuration details using the ",m("i",{className:"fas fa-arrow-right"})," icon"),m("li",null,m("strong",null,"Resources:")," Add related documentation and resources")),m("p",null,"This hierarchical structure helps users easily locate their vehicle's specific configuration."))),this.buildHierarchy(),this.loading?m(u(),null):this.buildSection()))))},e.saveSettings=function(){var t=this;if(!this.loading){this.loading=!0;var n=this.promptText,e=this.displayName;if(void 0===n||void 0===e)return a().alerts.show({type:"error"},"无法获取设置值"),void(this.loading=!1);var i={"ltydi-canbus-settings.promptText":n,"ltydi-canbus-settings.displayName":e};a().request({method:"POST",url:a().forum.attribute("apiUrl")+"/settings",body:i}).then((function(i){t.loading=!1,a().data.settings||(a().data.settings={}),a().data.settings["ltydi-canbus-settings.promptText"]=n,a().data.settings["ltydi-canbus-settings.displayName"]=e,a().forum&&a().forum.data&&a().forum.data.attributes&&(a().forum.data.attributes["canbus.promptText"]=n,a().forum.data.attributes["canbus.displayName"]=e,"ltydi-canbus-settings.promptText"in a().forum.data.attributes&&(a().forum.data.attributes["ltydi-canbus-settings.promptText"]=n),"ltydi-canbus-settings.displayName"in a().forum.data.attributes&&(a().forum.data.attributes["ltydi-canbus-settings.displayName"]=e)),t.promptText=n,t.displayName=e;try{localStorage.setItem("canbus-settings-promptText",n),localStorage.setItem("canbus-settings-displayName",e)}catch(t){}a().alerts.show({type:"success"},"Settings saved successfully"),m.redraw()})).catch((function(i){var s={data:[{type:"settings",id:"ltydi-canbus-settings.promptText",attributes:{value:n}},{type:"settings",id:"ltydi-canbus-settings.displayName",attributes:{value:e}}]};a().request({method:"POST",url:a().forum.attribute("apiUrl")+"/settings",body:s}).then((function(i){t.loading=!1,a().data.settings||(a().data.settings={}),a().data.settings["ltydi-canbus-settings.promptText"]=n,a().data.settings["ltydi-canbus-settings.displayName"]=e,a().forum&&a().forum.data&&a().forum.data.attributes&&(a().forum.data.attributes["canbus.promptText"]=n,a().forum.data.attributes["canbus.displayName"]=e,"ltydi-canbus-settings.promptText"in a().forum.data.attributes&&(a().forum.data.attributes["ltydi-canbus-settings.promptText"]=n),"ltydi-canbus-settings.displayName"in a().forum.data.attributes&&(a().forum.data.attributes["ltydi-canbus-settings.displayName"]=e));try{localStorage.setItem("canbus-settings-promptText",n),localStorage.setItem("canbus-settings-displayName",e)}catch(t){}a().alerts.show({type:"success"},"Settings saved successfully"),m.redraw()})).catch((function(i){t.loading=!1;var s="Unknown error";if(i&&(i.message&&(s=i.message),i.response))try{if(i.response.data&&i.response.data.errors&&i.response.data.errors.length>0){var r=i.response.data.errors[0];s=r.detail||r.title||s}}catch(t){}try{a().data.settings||(a().data.settings={}),a().data.settings["ltydi-canbus-settings.promptText"]=n,a().data.settings["ltydi-canbus-settings.displayName"]=e,a().forum&&a().forum.data&&a().forum.data.attributes&&(a().forum.data.attributes["canbus.promptText"]=n,a().forum.data.attributes["canbus.displayName"]=e,"ltydi-canbus-settings.promptText"in a().forum.data.attributes&&(a().forum.data.attributes["ltydi-canbus-settings.promptText"]=n),"ltydi-canbus-settings.displayName"in a().forum.data.attributes&&(a().forum.data.attributes["ltydi-canbus-settings.displayName"]=e)),t.promptText=n,t.displayName=e;try{localStorage.setItem("canbus-settings-promptText",n),localStorage.setItem("canbus-settings-displayName",e)}catch(t){}}catch(t){}a().alerts.show({type:"error"},"Failed to save settings: "+s)}))}))}},e.buildHierarchy=function(){var t=this;return 0===this.hierarchy.length?null:m("div",{className:"CanBusHierarchy"},m("div",{className:"hierarchy-item",onclick:function(){return t.navigateTo("brands")}},m("i",{className:"fas fa-home"})," ",a().translator.trans("ltydi-canbus-settings.admin.brands.brand_list")),this.hierarchy.map((function(n,a){return m("div",{className:"hierarchy-item",onclick:function(){return t.navigateTo(n.type,n,a)}},t.getIconForType(n.type)," ",n.name)})))},e.getIconForType=function(t){switch(t){case"models":return m("i",{className:"fas fa-car"});case"years":return m("i",{className:"fas fa-calendar-alt"});case"configs":return m("i",{className:"fas fa-cogs"});case"links":return m("i",{className:"fas fa-link"});default:return m("i",{className:"fas fa-folder"})}},e.navigateTo=function(t,n,a){void 0===n&&(n=null),void 0===a&&(a=null),this.section=t,null!==a?this.hierarchy=this.hierarchy.slice(0,a+1):"brands"===t&&(this.hierarchy=[]),m.redraw()},e.buildSection=function(){switch(this.section){case"brands":return this.buildBrandList();case"models":return m(b,{brandId:this.hierarchy[0].id,onSelect:this.selectModel.bind(this)});case"years":return m(w,{modelId:this.hierarchy[1].id,onSelect:this.selectYear.bind(this)});case"configs":return m(C,{yearId:this.hierarchy[2].id,onSelect:this.selectConfig.bind(this)});case"links":return m(I,{configId:this.hierarchy[3].id,onUpdate:this.handleLinkUpdate.bind(this)});default:return m("div",null,"Unknown section")}},e.buildBrandList=function(){var t=this;return m("div",{className:"BrandList"},m("h3",null,a().translator.trans("ltydi-canbus-settings.admin.brands.title")),m("p",{className:"helpText"},a().translator.trans("ltydi-canbus-settings.admin.brands.help_text")),m("div",{className:"CanBusForm"},m("div",{className:"form-group"},m("label",null,a().translator.trans("ltydi-canbus-settings.admin.brands.add_new")),m("input",{type:"text",className:"FormControl",value:this.newBrand||"",oninput:function(n){return t.newBrand=n.target.value},placeholder:a().translator.trans("ltydi-canbus-settings.admin.brands.placeholder")})),l().component({className:"Button Button--primary",disabled:this.loading||!this.newBrand||""===this.newBrand.trim(),onclick:function(){return t.saveBrand()},icon:"fas fa-plus"},a().translator.trans("ltydi-canbus-settings.admin.brands.add_button"))),m("div",{className:"CanBusTableContainer"},m("table",{className:"CanBusTable"},m("thead",null,m("tr",null,m("th",null,a().translator.trans("ltydi-canbus-settings.admin.brands.brand_name",{},"Brand Name")),m("th",{className:"actions"},a().translator.trans("ltydi-canbus-settings.admin.common.actions",{},"Actions")))),m("tbody",null,this.brands&&this.brands.map((function(n){return m("tr",{key:n.id},m("td",null,n.attributes.name),m("td",{className:"actions"},l().component({className:"Button Button--icon",icon:"fas fa-edit",onclick:function(){return t.editBrand(n)},title:a().translator.trans("ltydi-canbus-settings.admin.common.edit_title")}),l().component({className:"Button Button--icon",icon:"fas fa-trash",onclick:function(){return t.deleteBrand(n)},title:a().translator.trans("ltydi-canbus-settings.admin.common.delete_title")}),l().component({className:"Button Button--icon",icon:"fas fa-arrow-right",onclick:function(){return t.selectBrand(n)},title:a().translator.trans("ltydi-canbus-settings.admin.brands.view_models_title")})))})),(!this.brands||0===this.brands.length)&&m("tr",null,m("td",{colSpan:"2",className:"text-center"},a().translator.trans("ltydi-canbus-settings.admin.brands.no_brands")))))))},e.selectBrand=function(t){this.hierarchy=[{type:"models",id:t.id,name:t.attributes.name}],this.section="models",m.redraw()},e.selectModel=function(t){this.hierarchy.push({type:"years",id:t.id,name:t.attributes.name}),this.section="years",m.redraw()},e.selectYear=function(t){this.hierarchy.push({type:"configs",id:t.id,name:t.attributes.year_range}),this.section="configs",m.redraw()},e.selectConfig=function(t){if(t&&t.id)try{this.hierarchy.push({type:"links",id:t.id,name:t.attributes.name}),this.section="links",m.redraw()}catch(t){alert("Error selecting configuration: "+t.message)}else alert("Unable to select configuration: Invalid configuration data")},e.saveBrand=function(){var t=this;if(this.newBrand&&this.newBrand.trim()){var n=this.newBrand.trim();this.loading=!0;var e=a().forum.attribute("apiUrl")+"/canbus/brands?name="+encodeURIComponent(n);a().request({method:"POST",url:e}).then((function(n){t.brands.push(n.data),t.newBrand="",t.loading=!1,m.redraw()})).catch((function(n){a().request({method:"POST",url:a().forum.attribute("apiUrl")+"/canbus/brands"}).then((function(n){t.brands.push(n.data),t.newBrand="",t.loading=!1,m.redraw()})).catch((function(a){t.loading=!1,m.redraw(),alert("Error adding brand: "+(n.response&&n.response.errors?n.response.errors[0].detail:n))}))}))}else alert("Brand name cannot be empty")},e.editBrand=function(t){var n=this;a().modal.show(g,{brand:t,onsubmit:function(e){if(e&&e!==t.attributes.name){n.loading=!0;var i={data:{type:"canbus-brands",id:t.id,attributes:{name:e.trim()}}};a().request({method:"PATCH",url:a().forum.attribute("apiUrl")+"/canbus/brands/"+t.id,body:i}).then((function(i){var s=n.brands.findIndex((function(n){return n.id===t.id}));-1!==s&&(n.brands[s]=i.data),n.loading=!1,m.redraw(),n.loadBrands(),a().alerts.show({type:"success"},"Brand updated successfully to: "+e.trim())})).catch((function(t){n.loading=!1,m.redraw(),alert("Error updating brand: "+(t.response&&t.response.errors?t.response.errors[0].detail:t))}))}}})},e.deleteBrand=function(t){var n=this;a().modal.show(y,{brand:t,onconfirm:function(){n.loading=!0,a().request({method:"DELETE",url:a().forum.attribute("apiUrl")+"/canbus/brands/"+t.id}).then((function(){n.brands=n.brands.filter((function(n){return n.id!==t.id})),n.loading=!1,m.redraw()})).catch((function(t){n.loading=!1,m.redraw(),alert("Error deleting brand: "+(t.response&&t.response.errors?t.response.errors[0].detail:t))}))}})},e.handleLinkUpdate=function(t){t&&t.action&&t.configId&&(this.section="links",m.redraw())},n}(r());a().initializers.add("ltydi/canbus-settings",(function(){a().extensionData.for("ltydi-canbus-settings").registerPage(M)}))})(),module.exports={}})();
//# sourceMappingURL=admin.js.map