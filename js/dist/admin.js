(()=>{var t={n:n=>{var e=n&&n.__esModule?()=>n.default:()=>n;return t.d(e,{a:e}),e},d:(n,e)=>{for(var a in e)t.o(e,a)&&!t.o(n,a)&&Object.defineProperty(n,a,{enumerable:!0,get:e[a]})},o:(t,n)=>Object.prototype.hasOwnProperty.call(t,n)};(()=>{"use strict";const n=flarum.core.compat["admin/app"];var e=t.n(n);function a(t,n){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},a(t,n)}function i(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,a(t,n)}const r=flarum.core.compat["admin/components/ExtensionPage"];var s=t.n(r);const o=flarum.core.compat["common/components/Button"];var l=t.n(o);const d=flarum.core.compat["common/components/LoadingIndicator"];var c=t.n(d);const u=flarum.core.compat["common/Component"];var h=t.n(u);const f=flarum.core.compat["common/components/Modal"];var p=t.n(f),g=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var e=n.prototype;return e.oninit=function(n){t.prototype.oninit.call(this,n),this.brand=this.attrs.brand,this.newName=this.brand.attributes.name||""},e.className=function(){return"EditBrandModal Modal--small"},e.title=function(){return"Edit Brand"},e.content=function(){var t=this;return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",null,"Brand Name"),m("input",{className:"FormControl",type:"text",value:this.newName,oninput:function(n){return t.newName=n.target.value}})),m("div",{className:"Form-group"},m(l(),{className:"Button Button--primary",type:"submit",onclick:function(){t.attrs.onsubmit(t.newName),t.hide()}},"Save Changes"))))},n}(p()),b=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var e=n.prototype;return e.oninit=function(n){t.prototype.oninit.call(this,n),this.brand=this.attrs.brand},e.className=function(){return"DeleteBrandModal Modal--small"},e.title=function(){return"Confirm Deletion"},e.content=function(){var t=this;return m("div",{className:"Modal-body"},m("p",null,'Are you sure you want to delete the brand "',this.brand.attributes.name,'"? This will also delete all associated models, years, configs, and links.'),m("div",{className:"Form-group"},m(l(),{className:"Button Button--primary Button--danger",onclick:function(){t.attrs.onconfirm(),t.hide()}},"Delete")," ",m(l(),{className:"Button",onclick:function(){return t.hide()}},"Cancel")))},n}(p()),y=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var a=n.prototype;return a.oninit=function(n){t.prototype.oninit.call(this,n),this.brandId=this.attrs.brandId,this.models=[],this.loading=!0,this.newModel="",this.loadModels()},a.loadModels=function(){var t=this;this.loading=!0,e().request({method:"GET",url:e().forum.attribute("apiUrl")+"/canbus/models",params:{filter:{brand_id:this.brandId}}}).then((function(n){t.models=n.data,t.loading=!1,m.redraw()})).catch((function(n){t.loading=!1,m.redraw(),alert("Error loading models: "+n)}))},a.view=function(){var t=this;return m("div",{className:"ModelList"},m("h3",null,"Car Models"),m("div",{className:"CanBusForm"},m("div",{className:"form-group"},m("label",null,"Add New Model"),m("input",{type:"text",className:"FormControl",value:this.newModel,oninput:function(n){return t.newModel=n.target.value},placeholder:"Enter model name"})),l().component({className:"Button Button--primary",disabled:this.loading,onclick:function(){return t.saveModel()}},"Add Model")),this.loading?m(c(),null):m("table",{className:"CanBusTable"},m("thead",null,m("tr",null,m("th",null,e().translator.trans("ltydi-canbus-settings.admin.models.model_name")),m("th",{className:"actions"},e().translator.trans("ltydi-canbus-settings.admin.common.actions")))),m("tbody",null,this.models.map((function(n){return m("tr",{key:n.id},m("td",null,n.attributes.name),m("td",{className:"actions"},l().component({className:"Button Button--icon",icon:"fas fa-edit",onclick:function(){return t.editModel(n)},title:e().translator.trans("ltydi-canbus-settings.admin.common.edit_title")}),l().component({className:"Button Button--icon",icon:"fas fa-trash",onclick:function(){return t.deleteModel(n)},title:e().translator.trans("ltydi-canbus-settings.admin.common.delete_title")}),l().component({className:"Button Button--icon",icon:"fas fa-arrow-right",onclick:function(){return t.attrs.onSelect(n)},title:e().translator.trans("ltydi-canbus-settings.admin.models.view_years_title")})))})),0===this.models.length&&m("tr",null,m("td",{colSpan:"2",className:"text-center"},e().translator.trans("ltydi-canbus-settings.admin.models.no_models"))))))},a.saveModel=function(){var t=this;if(this.newModel.trim()){var n=this.newModel.trim();this.loading=!0;var a=e().forum.attribute("apiUrl")+"/canbus/models?name="+encodeURIComponent(n)+"&brand_id="+encodeURIComponent(this.brandId);console.log("Adding model:",n,"for brand ID:",this.brandId),e().request({method:"POST",url:a}).then((function(n){t.models.push(n.data),t.newModel="",t.loading=!1,m.redraw()})).catch((function(n){console.error("Error adding model:",n),e().request({method:"POST",url:e().forum.attribute("apiUrl")+"/canbus/models"}).then((function(n){t.models.push(n.data),t.newModel="",t.loading=!1,m.redraw()})).catch((function(e){console.error("Second attempt failed:",e),t.loading=!1,m.redraw(),alert("Error adding model: "+(n.response&&n.response.errors?n.response.errors[0].detail:n))}))}))}else alert("Model name cannot be empty")},a.editModel=function(t){var n=this;e().modal.show(v,{model:t,onsubmit:function(a){if(a&&a!==t.attributes.name){n.loading=!0;var i={data:{type:"canbus-models",id:t.id,attributes:{name:a.trim()}}};e().request({method:"PATCH",url:e().forum.attribute("apiUrl")+"/canbus/models/"+t.id,body:i}).then((function(i){var r=n.models.findIndex((function(n){return n.id===t.id}));-1!==r&&(n.models[r]=i.data),n.loading=!1,m.redraw(),n.loadModels(!0),e().alerts.show({type:"success"},"Model updated successfully to: "+a.trim())})).catch((function(t){var e;console.error("Error updating model:",t),console.error("Response:",t.response),n.loading=!1,m.redraw(),alert("Error updating model: "+((null==(e=t.response)||null==(e=e.errors)||null==(e=e[0])?void 0:e.detail)||t))}))}}})},a.deleteModel=function(t){var n=this;e().modal.show(N,{model:t,onconfirm:function(){n.loading=!0,console.log("Deleting model with ID:",t.id),console.log("Request URL:",e().forum.attribute("apiUrl")+"/canbus/models/"+t.id),console.log("Request method: DELETE"),e().request({method:"DELETE",url:e().forum.attribute("apiUrl")+"/canbus/models/"+t.id}).then((function(){console.log("Model deleted successfully"),n.models=n.models.filter((function(n){return n.id!==t.id})),n.loading=!1,m.redraw()})).catch((function(t){var e;console.error("Error deleting model:",t),console.error("Response:",t.response),n.loading=!1,m.redraw(),alert("Error deleting model: "+((null==(e=t.response)||null==(e=e.errors)||null==(e=e[0])?void 0:e.detail)||t))}))}})},n}(h()),v=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var e=n.prototype;return e.oninit=function(n){t.prototype.oninit.call(this,n),this.model=this.attrs.model,this.newName=this.model.attributes.name||""},e.className=function(){return"EditModelModal Modal--small"},e.title=function(){return"Edit Model"},e.content=function(){var t=this;return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",null,"Model Name"),m("input",{className:"FormControl",type:"text",value:this.newName,oninput:function(n){return t.newName=n.target.value}})),m("div",{className:"Form-group"},m(l(),{className:"Button Button--primary",type:"submit",onclick:function(){t.attrs.onsubmit(t.newName),t.hide()}},"Save Changes"))))},n}(p()),N=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var e=n.prototype;return e.oninit=function(n){t.prototype.oninit.call(this,n),this.model=this.attrs.model},e.className=function(){return"DeleteModelModal Modal--small"},e.title=function(){return"Confirm Deletion"},e.content=function(){var t=this;return m("div",{className:"Modal-body"},m("p",null,'Are you sure you want to delete the model "',this.model.attributes.name,'"? This will also delete all associated years, configs and links.'),m("div",{className:"Form-group"},m(l(),{className:"Button Button--primary Button--danger",onclick:function(){t.attrs.onconfirm(),t.hide()}},"Delete")," ",m(l(),{className:"Button",onclick:function(){return t.hide()}},"Cancel")))},n}(p());jQuery;var w=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var a=n.prototype;return a.oninit=function(n){t.prototype.oninit.call(this,n),this.modelId=this.attrs.modelId,this.years=[],this.loading=!0,this.newYearRange="",this.editingYearId=null,this.editYearRange="",this.loadYears()},a.onupdate=function(t){this.modelId!==this.attrs.modelId&&(this.modelId=this.attrs.modelId,this.years=[],this.loading=!0,this.loadYears())},a.loadYears=function(t){var n=this;if(void 0===t&&(t=!1),!this.modelId)return this.years=[],this.loading=!1,void m.redraw();this.loading=!0;var a=e().forum.attribute("apiUrl")+"/canbus/years",i={"filter[model_id]":this.modelId};t&&(i._nocache=(new Date).getTime()),e().request({method:"GET",url:a,params:i,headers:t?{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}:{}}).then((function(t){n.years=t.data||[],n.loading=!1,m.redraw()})).catch((function(t){n.years=[],n.loading=!1,m.redraw()}))},a.view=function(){var t=this;return this.modelId?m("div",{className:"YearList"},m("h3",null,"Year Ranges"),m("div",{className:"CanBusForm"},m("div",{className:"form-group"},m("label",null,"Add New Year Range"),m("input",{type:"text",className:"FormControl",value:this.newYearRange,oninput:function(n){return t.newYearRange=n.target.value},placeholder:"e.g. 2010-2015"})),m(l(),{className:"Button Button--primary",disabled:this.loading,onclick:function(){return t.saveYear()}},"Add Year Range")),this.loading?m(c(),null):m("table",{className:"CanBusTable"},m("thead",null,m("tr",null,m("th",null,e().translator.trans("ltydi-canbus-settings.admin.years.year_range")),m("th",{className:"actions"},e().translator.trans("ltydi-canbus-settings.admin.common.actions")))),m("tbody",null,this.years.map((function(n){return m("tr",{key:n.id},m("td",null,n.attributes.year_range),m("td",{className:"actions"},l().component({className:"Button Button--icon",icon:"fas fa-edit",onclick:function(){return t.editYear(n)},title:e().translator.trans("ltydi-canbus-settings.admin.common.edit_title")}),l().component({className:"Button Button--icon",icon:"fas fa-trash",onclick:function(){return t.deleteYear(n)},title:e().translator.trans("ltydi-canbus-settings.admin.common.delete_title")}),l().component({className:"Button Button--icon",icon:"fas fa-arrow-right",onclick:function(){return t.attrs.onSelect(n)},title:e().translator.trans("ltydi-canbus-settings.admin.years.view_configs_title")})))})),0===this.years.length&&m("tr",null,m("td",{colSpan:"2",className:"text-center"},e().translator.trans("ltydi-canbus-settings.admin.years.no_years")))))):m("div",{className:"YearList"},m("p",null,"Please select a model first."))},a.saveYear=function(){var t=this;if(this.newYearRange&&this.newYearRange.trim()){this.loading=!0;var n={data:{type:"canbus-years",attributes:{year_range:this.newYearRange.trim()},relationships:{model:{data:{type:"canbus-models",id:this.modelId}}}}};e().request({method:"POST",url:e().forum.attribute("apiUrl")+"/canbus/years",body:n}).then((function(n){t.years.push(n.data),t.newYearRange="",t.loading=!1,m.redraw()})).catch((function(n){var e;t.loading=!1,m.redraw(),alert("Error adding year: "+((null==(e=n.response)||null==(e=e.errors)||null==(e=e[0])?void 0:e.detail)||n))}))}},a.deleteYear=function(t){var n=this;e().modal.show(B,{year:t,onconfirm:function(){n.loading=!0,e().request({method:"DELETE",url:e().forum.attribute("apiUrl")+"/canbus/years/"+t.id}).then((function(){n.years=n.years.filter((function(n){return n.id!==t.id})),n.loading=!1,m.redraw()})).catch((function(t){n.loading=!1,m.redraw(),alert("Error deleting year: "+t)}))}})},a.editYear=function(t){var n=this;e().modal.show(k,{year:t,onsubmit:function(a){if(a&&a!==t.attributes.year_range){n.loading=!0;var i={data:{type:"canbus-years",id:t.id,attributes:{year_range:a.trim()}}};if(!t.id)return alert("Error: Year ID cannot be empty"),n.loading=!1,void m.redraw();e().request({method:"PATCH",url:e().forum.attribute("apiUrl")+"/canbus/years/"+t.id,body:i}).then((function(i){var r=n.years.findIndex((function(n){return n.id===t.id}));-1!==r&&(n.years[r]=i.data),n.loading=!1,m.redraw(),n.loadYears(!0),e().alerts.show({type:"success"},"Year range updated successfully to: "+a.trim())})).catch((function(t){var e;n.loading=!1,m.redraw(),alert("Error updating year: "+((null==(e=t.response)||null==(e=e.errors)||null==(e=e[0])?void 0:e.detail)||t))}))}}})},n}(h()),k=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var e=n.prototype;return e.oninit=function(n){t.prototype.oninit.call(this,n),this.year=this.attrs.year,this.newYearRange=this.year.attributes.year_range||""},e.className=function(){return"EditYearModal Modal--small"},e.title=function(){return"Edit Year Range"},e.content=function(){var t=this;return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",null,"Year Range"),m("input",{className:"FormControl",type:"text",value:this.newYearRange,oninput:function(n){return t.newYearRange=n.target.value},placeholder:"e.g. 2010-2015"})),m("div",{className:"Form-group"},m(l(),{className:"Button Button--primary",type:"submit",onclick:function(){t.attrs.onsubmit(t.newYearRange),t.hide()}},"Save Changes"))))},n}(p()),B=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var e=n.prototype;return e.oninit=function(n){t.prototype.oninit.call(this,n),this.year=this.attrs.year},e.className=function(){return"DeleteYearModal Modal--small"},e.title=function(){return"Confirm Deletion"},e.content=function(){var t=this;return m("div",{className:"Modal-body"},m("p",null,'Are you sure you want to delete the year range "',this.year.attributes.year_range,'"? This will also delete all associated configs and links.'),m("div",{className:"Form-group"},m(l(),{className:"Button Button--primary Button--danger",onclick:function(){t.attrs.onconfirm(),t.hide()}},"Delete")," ",m(l(),{className:"Button",onclick:function(){return t.hide()}},"Cancel")))},n}(p()),C=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var a=n.prototype;return a.oninit=function(n){t.prototype.oninit.call(this,n),this.yearId=this.attrs.yearId,this.configs=[],this.loading=!0,this.newConfigName="",this.loadConfigs()},a.loadConfigs=function(t){var n=this;if(void 0===t&&(t=!1),!this.yearId)return this.configs=[],this.loading=!1,void m.redraw();this.loading=!0,e().request({method:"GET",url:e().forum.attribute("apiUrl")+"/canbus/configs",params:{"filter[year_id]":this.yearId}}).then((function(e){n.configs=e.data||[],n.loading=!1,m.redraw(),t&&n.loadConfigs(!1)})).catch((function(t){n.configs=[],n.loading=!1,m.redraw()}))},a.view=function(){var t=this;return this.yearId?m("div",{className:"ConfigList"},m("h3",null,"Configuration List"),m("div",{className:"CanBusForm"},m("div",{className:"form-group"},m("label",null,"Add New Configuration"),m("input",{type:"text",className:"FormControl",value:this.newConfigName,oninput:function(n){return t.newConfigName=n.target.value},placeholder:"e.g. Manual AC"})),m(l(),{className:"Button Button--primary",disabled:this.loading,onclick:function(){return t.saveConfig()}},"Add Configuration")),this.loading?m(c(),null):m("table",{className:"CanBusTable"},m("thead",null,m("tr",null,m("th",null,e().translator.trans("ltydi-canbus-settings.admin.configs.config_name")),m("th",{className:"actions"},e().translator.trans("ltydi-canbus-settings.admin.common.actions")))),m("tbody",null,this.configs.map((function(n){return m("tr",{key:n.id},m("td",null,n.attributes.name),m("td",{className:"actions"},l().component({className:"Button Button--icon",icon:"fas fa-edit",onclick:function(){return t.editConfig(n)},title:e().translator.trans("ltydi-canbus-settings.admin.common.edit_title")}),l().component({className:"Button Button--icon",icon:"fas fa-trash",onclick:function(){return t.deleteConfig(n)},title:e().translator.trans("ltydi-canbus-settings.admin.common.delete_title")}),l().component({className:"Button Button--icon",icon:"fas fa-arrow-right",onclick:function(){return t.attrs.onSelect(n)},title:e().translator.trans("ltydi-canbus-settings.admin.configs.view_links_title")})))})),0===this.configs.length&&m("tr",null,m("td",{colSpan:"2",className:"text-center"},e().translator.trans("ltydi-canbus-settings.admin.configs.no_configs")))))):m("div",{className:"ConfigList"},m("p",null,"Please select a year first."))},a.saveConfig=function(){var t=this;if(this.newConfigName&&this.newConfigName.trim()){this.loading=!0;var n={data:{type:"canbus-configs",attributes:{name:this.newConfigName.trim()},relationships:{year:{data:{type:"canbus-years",id:this.yearId}}}}};e().request({method:"POST",url:e().forum.attribute("apiUrl")+"/canbus/configs",body:n}).then((function(n){t.configs.push(n.data),t.newConfigName="",t.loading=!1,m.redraw()})).catch((function(n){var e;t.loading=!1,m.redraw(),alert("Error adding configuration: "+((null==(e=n.response)||null==(e=e.errors)||null==(e=e[0])?void 0:e.detail)||n))}))}},a.editConfig=function(t){var n=this;e().modal.show(T,{config:t,onsubmit:function(a){if(a&&a!==t.attributes.name){n.loading=!0;var i={data:{type:"canbus-configs",id:t.id,attributes:{name:a.trim()}}};e().request({method:"PATCH",url:e().forum.attribute("apiUrl")+"/canbus/configs/"+t.id,body:i}).then((function(i){var r=n.configs.findIndex((function(n){return n.id===t.id}));-1!==r&&(n.configs[r]=i.data),n.loading=!1,m.redraw(),n.loadConfigs(!0),e().alerts.show({type:"success"},"Configuration updated successfully to: "+a.trim())})).catch((function(t){var e;n.loading=!1,m.redraw(),alert("Error updating configuration: "+((null==(e=t.response)||null==(e=e.errors)||null==(e=e[0])?void 0:e.detail)||t))}))}}})},a.deleteConfig=function(t){var n=this;e().modal.show(x,{config:t,onconfirm:function(){n.loading=!0,e().request({method:"DELETE",url:e().forum.attribute("apiUrl")+"/canbus/configs/"+t.id}).then((function(){n.configs=n.configs.filter((function(n){return n.id!==t.id})),n.loading=!1,m.redraw()})).catch((function(t){var e;n.loading=!1,m.redraw(),alert("Error deleting configuration: "+((null==(e=t.response)||null==(e=e.errors)||null==(e=e[0])?void 0:e.detail)||t))}))}})},n}(h()),T=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var e=n.prototype;return e.oninit=function(n){t.prototype.oninit.call(this,n),this.config=this.attrs.config,this.newName=this.config.attributes.name||""},e.className=function(){return"EditConfigModal Modal--small"},e.title=function(){return"Edit Configuration"},e.content=function(){var t=this;return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",null,"Configuration Name"),m("input",{className:"FormControl",type:"text",value:this.newName,oninput:function(n){return t.newName=n.target.value}})),m("div",{className:"Form-group"},m(l(),{className:"Button Button--primary",type:"submit",onclick:function(){t.attrs.onsubmit(t.newName),t.hide()}},"Save Changes"))))},n}(p()),x=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var e=n.prototype;return e.oninit=function(n){t.prototype.oninit.call(this,n),this.config=this.attrs.config},e.className=function(){return"DeleteConfigModal Modal--small"},e.title=function(){return"Confirm Deletion"},e.content=function(){var t=this;return m("div",{className:"Modal-body"},m("p",null,'Are you sure you want to delete the configuration "',this.config.attributes.name,'"? This will also delete all associated links.'),m("div",{className:"Form-group"},m(l(),{className:"Button Button--primary Button--danger",onclick:function(){t.attrs.onconfirm(),t.hide()}},"Delete")," ",m(l(),{className:"Button",onclick:function(){return t.hide()}},"Cancel")))},n}(p()),L=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var a=n.prototype;return a.oninit=function(n){var e=this;t.prototype.oninit.call(this,n);try{if(console.log("LinkList initializing with attrs:",n.attrs),this.configId=n.attrs?n.attrs.configId:null,console.log("Extracted configId:",this.configId),this.links=[],this.loading=!0,this.newLink="",this.newLinkDescription="",!this.configId)return console.error("ConfigId is missing or invalid:",this.configId,", cannot load links"),void(this.loading=!1);setTimeout((function(){try{e.loadLinks()}catch(t){console.error("Error in delayed loadLinks:",t),e.loading=!1,m.redraw()}}),100)}catch(t){console.error("Error in LinkList initialization:",t),this.loading=!1}},a.loadLinks=function(){var t=this;try{if(!this.configId)return console.error("Attempting to load links but configId is missing"),this.links=[],this.loading=!1,void m.redraw();this.loading=!0,console.log("Loading links for config ID:",this.configId),e().request({method:"GET",url:e().forum.attribute("apiUrl")+"/canbus/links",params:{"filter[config_id]":this.configId}}).then((function(n){console.log("Loaded links:",n),n&&n.data?t.links=Array.isArray(n.data)?n.data:[]:(console.warn("Response missing data property:",n),t.links=[]),t.loading=!1,m.redraw()})).catch((function(n){console.error("Error loading links:",n),console.error("Response:",n.response),t.links=[],t.loading=!1,m.redraw()}))}catch(t){console.error("Unexpected error in loadLinks:",t),this.links=[],this.loading=!1,m.redraw()}},a.view=function(){var t=this;try{if(!this.configId)return m("div",{className:"LinkList"},m("h3",null,"Link List"),m("div",{className:"CanBusNoLink"},m("p",null,"No configuration selected. Please choose a configuration first.")));var n=this.links&&Array.isArray(this.links)&&this.links.length>0;return m("div",{className:"LinkList"},m("h3",null,"Link List"),!n&&!this.loading&&m("div",{className:"CanBusForm"},m("div",{className:"form-group"},m("label",null,"Add Link"),m("input",{type:"text",className:"FormControl",value:this.newLink,oninput:function(n){return t.newLink=n.target.value},placeholder:"https://example.com/canbus-link"}),m("label",{style:{marginTop:"10px"}},"Link Description"),m("textarea",{className:"FormControl",value:this.newLinkDescription||"",oninput:function(n){return t.newLinkDescription=n.target.value},placeholder:"Optional: Add a description for this link",rows:"3"})),m(l(),{className:"Button Button--primary",disabled:this.loading,onclick:function(){return t.saveLink()}},"Add Link")),this.loading?m(c(),null):m("table",{className:"CanBusTable"},m("thead",null,m("tr",null,m("th",null,e().translator.trans("ltydi-canbus-settings.admin.links.link_url")),m("th",{className:"actions"},e().translator.trans("ltydi-canbus-settings.admin.common.actions")))),m("tbody",null,this.links&&this.links.map((function(n){return n&&n.attributes?m("tr",{key:n.id},m("td",null,[m("div",{className:"link-url"},m("a",{href:n.attributes.url,target:"_blank",rel:"noopener noreferrer"},n.attributes.url)),n.attributes.description&&m("div",{className:"LinkDescription",style:{marginTop:"5px",fontSize:"0.9em",color:"#666"}},n.attributes.description)]),m("td",{className:"actions"},l().component({className:"Button Button--icon",icon:"fas fa-edit",onclick:function(){return t.editLink(n)},title:e().translator.trans("ltydi-canbus-settings.admin.common.edit_title")}),l().component({className:"Button Button--icon",icon:"fas fa-trash",onclick:function(){return t.deleteLink(n)},title:e().translator.trans("ltydi-canbus-settings.admin.common.delete_title")}))):(console.error("Invalid link data:",n),null)})),(!this.links||0===this.links.length)&&m("tr",null,m("td",{colSpan:"2",className:"text-center"},e().translator.trans("ltydi-canbus-settings.admin.links.no_links"))))))}catch(t){return console.error("Error in LinkList view:",t),m("div",{className:"LinkList"},m("h3",null,"Link List"),m("div",{className:"CanBusError"},m("p",null,"An error occurred while displaying links. Please try again or contact support."),m("p",{className:"ErrorDetails"},t.message)))}},a.saveLink=function(){var t=this;if(this.newLink&&this.newLink.trim())if(this.links.length>0)alert("Each configuration can only have one link.");else{this.loading=!0,console.log("Adding new link for config ID:",this.configId);var n={data:{type:"canbus-links",attributes:{url:this.newLink.trim(),description:this.newLinkDescription?this.newLinkDescription.trim():""},relationships:{config:{data:{type:"canbus-configs",id:this.configId}}}}};console.log("Request data:",n),e().request({method:"POST",url:e().forum.attribute("apiUrl")+"/canbus/links",body:n}).then((function(n){console.log("Link added successfully:",n),t.links.push(n.data),t.newLink="",t.newLinkDescription="",t.loading=!1,t.attrs.onUpdate&&t.attrs.onUpdate({action:"add",configId:t.configId}),m.redraw()})).catch((function(e){var a;console.error("Error adding link:",e),console.error("Request data:",n),console.error("Response:",e.response),t.loading=!1,m.redraw(),alert("Error adding link: "+((null==(a=e.response)||null==(a=a.errors)||null==(a=a[0])?void 0:a.detail)||e))}))}},a.editLink=function(t){var n=this;t&&t.attributes?e().modal.show(I,{link:t,onsubmit:function(a,i){if(a&&(a!==t.attributes.url||i!==t.attributes.description)){n.loading=!0;var r={data:{type:"canbus-links",id:t.id,attributes:{url:a.trim(),description:i?i.trim():""}}};e().request({method:"PATCH",url:e().forum.attribute("apiUrl")+"/canbus/links/"+t.id,body:r}).then((function(e){var a=n.links.findIndex((function(n){return n.id===t.id}));-1!==a&&(n.links[a]=e.data),n.loading=!1,n.attrs.onUpdate&&n.attrs.onUpdate({action:"edit",configId:n.configId}),m.redraw()})).catch((function(t){var e;n.loading=!1,m.redraw(),alert("Error updating link: "+((null==(e=t.response)||null==(e=e.errors)||null==(e=e[0])?void 0:e.detail)||t))}))}}}):console.error("Link object or attributes are undefined")},a.deleteLink=function(t){var n=this;e().modal.show(E,{onconfirm:function(){n.loading=!0,e().request({method:"DELETE",url:e().forum.attribute("apiUrl")+"/canbus/links/"+t.id}).then((function(){n.links=n.links.filter((function(n){return n.id!==t.id})),n.loading=!1,n.attrs.onUpdate&&n.attrs.onUpdate({action:"delete",configId:n.configId}),m.redraw()})).catch((function(t){var e;n.loading=!1,m.redraw(),alert("Error deleting link: "+((null==(e=t.response)||null==(e=e.errors)||null==(e=e[0])?void 0:e.detail)||t))}))}})},n}(h()),I=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var e=n.prototype;return e.oninit=function(n){t.prototype.oninit.call(this,n),this.link=this.attrs.link,this.url=this.link.attributes.url||"",this.description=this.link.attributes.description||""},e.className=function(){return"EditLinkModal Modal--small"},e.title=function(){return"Edit Link"},e.content=function(){var t=this;return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",null,"Link URL"),m("input",{className:"FormControl",type:"text",value:this.url,oninput:function(n){return t.url=n.target.value}})),m("div",{className:"Form-group"},m("label",null,"Link Description (Optional)"),m("textarea",{className:"FormControl",value:this.description,oninput:function(n){return t.description=n.target.value},rows:"3"})),m("div",{className:"Form-group"},m(l(),{className:"Button Button--primary",type:"submit",onclick:function(){t.attrs.onsubmit(t.url,t.description),t.hide()}},"Save Changes"))))},n}(p()),E=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var e=n.prototype;return e.className=function(){return"DeleteConfirmModal Modal--small"},e.title=function(){return"Confirm Deletion"},e.content=function(){var t=this;return m("div",{className:"Modal-body"},m("p",null,"Are you sure you want to delete this link?"),m("div",{className:"Form-group"},m(l(),{className:"Button Button--primary Button--danger",onclick:function(){t.attrs.onconfirm(),t.hide()}},"Delete")," ",m(l(),{className:"Button",onclick:function(){return t.hide()}},"Cancel")))},n}(p()),M=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var a=n.prototype;return a.refreshSettings=function(){return e().request({method:"POST",url:e().forum.attribute("apiUrl")+"/settings",body:{data:[{type:"settings",id:"ltydi-canbus-settings.promptText"}]}}).then((function(t){return t&&t.data&&t.data.forEach((function(t){"ltydi-canbus-settings.promptText"===t.id&&(e().data.settings||(e().data.settings={}),e().data.settings["ltydi-canbus-settings.promptText"]=t.attributes.value,e().forum&&e().forum.data&&e().forum.data.attributes&&(e().forum.data.attributes["canbus.promptText"]=t.attributes.value))})),t})).catch((function(t){try{var n=localStorage.getItem("canbus-settings-promptText");n&&(e().data.settings||(e().data.settings={}),e().data.settings["ltydi-canbus-settings.promptText"]=n)}catch(t){}return{data:[]}}))},a.oninit=function(n){var a=this;t.prototype.oninit.call(this,n),this.loading=!0,this.section="brands",this.hierarchy=[],this.promptText="";try{var i=localStorage.getItem("canbus-settings-promptText");i&&(this.promptText=i)}catch(t){}this.refreshSettings().then((function(){e().forum&&e().forum.attribute("canbus.promptText")?a.promptText=e().forum.attribute("canbus.promptText"):e().data&&e().data.settings&&e().data.settings["ltydi-canbus-settings.promptText"]&&(a.promptText=e().data.settings["ltydi-canbus-settings.promptText"])})),this.loadBrands()},a.loadBrands=function(){var t=this;this.loading=!0,e().request({method:"GET",url:e().forum.attribute("apiUrl")+"/canbus/brands"}).then((function(n){t.brands=n.data||[],t.loading=!1,m.redraw()})).catch((function(n){t.brands=[],t.loading=!1,m.redraw()}))},a.content=function(){var t=this;return m("div",{className:"ExtensionPage-settings CanBusSettingsPage",style:{maxWidth:"none",margin:"0",width:"100%"}},m("div",{className:"container",style:{maxWidth:"none",padding:"0 20px",width:"100%",boxSizing:"border-box"}},m("div",{className:"Form-group",style:{width:"100%"}},m("label",null,"CanBus Message"),m("div",{className:"helpText"},"Customize the CanBus message that appears at the top of the settings page."),m("input",{id:"canbus-promptText-input",className:"FormControl",type:"text",value:this.promptText,oninput:function(n){return t.promptText=n.target.value},placeholder:"Welcome to the CanBus configuration page. Please select your vehicle details to find the appropriate settings.",style:{width:"100%",maxWidth:"none",boxSizing:"border-box"}}),m("p",{className:"helpText",style:{marginTop:"5px"}},m("i",{className:"fas fa-info-circle",style:{marginRight:"5px"}}),"This CanBus message helps guide users through the configuration process."),m("div",{className:"Form-group Form--controls"},l().component({type:"submit",className:"Button Button--primary",loading:this.loading,onclick:this.saveSettings.bind(this)},"Save Changes"))),m("div",{className:"FormSectionGroup",style:{width:"100%"}},m("div",{className:"FormSection"},m("label",null,"Vehicle Database"),m("p",{className:"helpText"},"Organize and manage vehicle information and configurations"),m("div",{className:"CanBusInstructions",style:{width:"100%"}},m("div",{className:"CanBusInstructions-header"},m("i",{className:"fas fa-info-circle"})," Database Management Guide"),m("div",{className:"CanBusInstructions-content"},m("p",null,"Follow these steps to manage vehicle configurations:"),m("ol",null,m("li",null,m("strong",null,"Brands:")," Add vehicle manufacturers"),m("li",null,m("strong",null,"Models:")," Add vehicle models using the ",m("i",{className:"fas fa-arrow-right"})," icon"),m("li",null,m("strong",null,"Years:")," Specify model years using the ",m("i",{className:"fas fa-arrow-right"})," icon"),m("li",null,m("strong",null,"Configurations:")," Add specific configurations using the ",m("i",{className:"fas fa-arrow-right"})," icon"),m("li",null,m("strong",null,"Settings:")," Add configuration details using the ",m("i",{className:"fas fa-arrow-right"})," icon"),m("li",null,m("strong",null,"Resources:")," Add related documentation and resources")),m("p",null,"This hierarchical structure helps users easily locate their vehicle's specific configuration."))),this.buildHierarchy(),this.loading?m(c(),null):this.buildSection()))))},a.saveSettings=function(){var t=this;if(!this.loading){this.loading=!0;var n=this.promptText;if(void 0===n)return e().alerts.show({type:"error"},"无法获取设置值"),void(this.loading=!1);var a={"ltydi-canbus-settings.promptText":n};e().request({method:"POST",url:e().forum.attribute("apiUrl")+"/settings",body:a}).then((function(a){t.loading=!1,e().data.settings||(e().data.settings={}),e().data.settings["ltydi-canbus-settings.promptText"]=n,e().forum&&e().forum.data&&e().forum.data.attributes&&(e().forum.data.attributes["canbus.promptText"]=n,"ltydi-canbus-settings.promptText"in e().forum.data.attributes&&(e().forum.data.attributes["ltydi-canbus-settings.promptText"]=n)),t.promptText=n;try{localStorage.setItem("canbus-settings-promptText",n)}catch(t){}e().alerts.show({type:"success"},"Settings saved successfully"),m.redraw()})).catch((function(a){var i={data:[{type:"settings",id:"ltydi-canbus-settings.promptText",attributes:{value:n}}]};e().request({method:"POST",url:e().forum.attribute("apiUrl")+"/settings",body:i}).then((function(a){t.loading=!1,e().data.settings||(e().data.settings={}),e().data.settings["ltydi-canbus-settings.promptText"]=n,e().forum&&e().forum.data&&e().forum.data.attributes&&(e().forum.data.attributes["canbus.promptText"]=n,"ltydi-canbus-settings.promptText"in e().forum.data.attributes&&(e().forum.data.attributes["ltydi-canbus-settings.promptText"]=n));try{localStorage.setItem("canbus-settings-promptText",n)}catch(t){}e().alerts.show({type:"success"},"Settings saved successfully"),m.redraw()})).catch((function(a){t.loading=!1;var i="Unknown error";if(a&&(a.message&&(i=a.message),a.response))try{if(a.response.data&&a.response.data.errors&&a.response.data.errors.length>0){var r=a.response.data.errors[0];i=r.detail||r.title||i}}catch(t){}try{e().data.settings||(e().data.settings={}),e().data.settings["ltydi-canbus-settings.promptText"]=n,e().forum&&e().forum.data&&e().forum.data.attributes&&(e().forum.data.attributes["canbus.promptText"]=n,"ltydi-canbus-settings.promptText"in e().forum.data.attributes&&(e().forum.data.attributes["ltydi-canbus-settings.promptText"]=n)),t.promptText=n;try{localStorage.setItem("canbus-settings-promptText",n)}catch(t){}}catch(t){}e().alerts.show({type:"error"},"Failed to save settings: "+i)}))}))}},a.buildHierarchy=function(){var t=this;return 0===this.hierarchy.length?null:m("div",{className:"CanBusHierarchy"},m("div",{className:"hierarchy-item",onclick:function(){return t.navigateTo("brands")}},m("i",{className:"fas fa-home"})," ",e().translator.trans("ltydi-canbus-settings.admin.brands.brand_list")),this.hierarchy.map((function(n,e){return m("div",{className:"hierarchy-item",onclick:function(){return t.navigateTo(n.type,n,e)}},t.getIconForType(n.type)," ",n.name)})))},a.getIconForType=function(t){switch(t){case"models":return m("i",{className:"fas fa-car"});case"years":return m("i",{className:"fas fa-calendar-alt"});case"configs":return m("i",{className:"fas fa-cogs"});case"links":return m("i",{className:"fas fa-link"});default:return m("i",{className:"fas fa-folder"})}},a.navigateTo=function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=null),this.section=t,null!==e?this.hierarchy=this.hierarchy.slice(0,e+1):"brands"===t&&(this.hierarchy=[]),m.redraw()},a.buildSection=function(){switch(this.section){case"brands":return this.buildBrandList();case"models":return m(y,{brandId:this.hierarchy[0].id,onSelect:this.selectModel.bind(this)});case"years":return m(w,{modelId:this.hierarchy[1].id,onSelect:this.selectYear.bind(this)});case"configs":return m(C,{yearId:this.hierarchy[2].id,onSelect:this.selectConfig.bind(this)});case"links":return m(L,{configId:this.hierarchy[3].id,onUpdate:this.handleLinkUpdate.bind(this)});default:return m("div",null,"Unknown section")}},a.buildBrandList=function(){var t=this;return m("div",{className:"BrandList"},m("h3",null,e().translator.trans("ltydi-canbus-settings.admin.brands.title")),m("p",{className:"helpText"},e().translator.trans("ltydi-canbus-settings.admin.brands.help_text")),m("div",{className:"CanBusForm"},m("div",{className:"form-group"},m("label",null,e().translator.trans("ltydi-canbus-settings.admin.brands.add_new")),m("input",{type:"text",className:"FormControl",value:this.newBrand||"",oninput:function(n){return t.newBrand=n.target.value},placeholder:e().translator.trans("ltydi-canbus-settings.admin.brands.placeholder")})),l().component({className:"Button Button--primary",disabled:this.loading||!this.newBrand||""===this.newBrand.trim(),onclick:function(){return t.saveBrand()},icon:"fas fa-plus"},e().translator.trans("ltydi-canbus-settings.admin.brands.add_button"))),m("div",{className:"CanBusTableContainer"},m("table",{className:"CanBusTable"},m("thead",null,m("tr",null,m("th",null,e().translator.trans("ltydi-canbus-settings.admin.brands.brand_name",{},"Brand Name")),m("th",{className:"actions"},e().translator.trans("ltydi-canbus-settings.admin.common.actions",{},"Actions")))),m("tbody",null,this.brands&&this.brands.map((function(n){return m("tr",{key:n.id},m("td",null,n.attributes.name),m("td",{className:"actions"},l().component({className:"Button Button--icon",icon:"fas fa-edit",onclick:function(){return t.editBrand(n)},title:e().translator.trans("ltydi-canbus-settings.admin.common.edit_title")}),l().component({className:"Button Button--icon",icon:"fas fa-trash",onclick:function(){return t.deleteBrand(n)},title:e().translator.trans("ltydi-canbus-settings.admin.common.delete_title")}),l().component({className:"Button Button--icon",icon:"fas fa-arrow-right",onclick:function(){return t.selectBrand(n)},title:e().translator.trans("ltydi-canbus-settings.admin.brands.view_models_title")})))})),(!this.brands||0===this.brands.length)&&m("tr",null,m("td",{colSpan:"2",className:"text-center"},e().translator.trans("ltydi-canbus-settings.admin.brands.no_brands")))))))},a.selectBrand=function(t){this.hierarchy=[{type:"models",id:t.id,name:t.attributes.name}],this.section="models",m.redraw()},a.selectModel=function(t){this.hierarchy.push({type:"years",id:t.id,name:t.attributes.name}),this.section="years",m.redraw()},a.selectYear=function(t){this.hierarchy.push({type:"configs",id:t.id,name:t.attributes.year_range}),this.section="configs",m.redraw()},a.selectConfig=function(t){if(t&&t.id)try{this.hierarchy.push({type:"links",id:t.id,name:t.attributes.name}),this.section="links",m.redraw()}catch(t){alert("Error selecting configuration: "+t.message)}else alert("Unable to select configuration: Invalid configuration data")},a.saveBrand=function(){var t=this;if(this.newBrand&&this.newBrand.trim()){var n=this.newBrand.trim();this.loading=!0;var a=e().forum.attribute("apiUrl")+"/canbus/brands?name="+encodeURIComponent(n);e().request({method:"POST",url:a}).then((function(n){t.brands.push(n.data),t.newBrand="",t.loading=!1,m.redraw()})).catch((function(n){e().request({method:"POST",url:e().forum.attribute("apiUrl")+"/canbus/brands"}).then((function(n){t.brands.push(n.data),t.newBrand="",t.loading=!1,m.redraw()})).catch((function(e){t.loading=!1,m.redraw(),alert("Error adding brand: "+(n.response&&n.response.errors?n.response.errors[0].detail:n))}))}))}else alert("Brand name cannot be empty")},a.editBrand=function(t){var n=this;e().modal.show(g,{brand:t,onsubmit:function(a){if(a&&a!==t.attributes.name){n.loading=!0;var i={data:{type:"canbus-brands",id:t.id,attributes:{name:a.trim()}}};e().request({method:"PATCH",url:e().forum.attribute("apiUrl")+"/canbus/brands/"+t.id,body:i}).then((function(i){var r=n.brands.findIndex((function(n){return n.id===t.id}));-1!==r&&(n.brands[r]=i.data),n.loading=!1,m.redraw(),n.loadBrands(),e().alerts.show({type:"success"},"Brand updated successfully to: "+a.trim())})).catch((function(t){n.loading=!1,m.redraw(),alert("Error updating brand: "+(t.response&&t.response.errors?t.response.errors[0].detail:t))}))}}})},a.deleteBrand=function(t){var n=this;e().modal.show(b,{brand:t,onconfirm:function(){n.loading=!0,e().request({method:"DELETE",url:e().forum.attribute("apiUrl")+"/canbus/brands/"+t.id}).then((function(){n.brands=n.brands.filter((function(n){return n.id!==t.id})),n.loading=!1,m.redraw()})).catch((function(t){n.loading=!1,m.redraw(),alert("Error deleting brand: "+(t.response&&t.response.errors?t.response.errors[0].detail:t))}))}})},a.handleLinkUpdate=function(t){t&&t.action&&t.configId&&(this.section="links",m.redraw())},n}(s());e().initializers.add("ltydi/canbus-settings",(function(){e().extensionData.for("ltydi-canbus-settings").registerPage(M)}))})(),module.exports={}})();
//# sourceMappingURL=admin.js.map