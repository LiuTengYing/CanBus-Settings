(()=>{var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var s in n)e.o(n,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:n[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{"use strict";e.r(t),e.d(t,{CanBusPage:()=>g,app:()=>s()});const n=flarum.core.compat["forum/app"];var s=e.n(n);function i(e,t){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},i(e,t)}const a=flarum.core.compat["common/components/Page"];var r=e.n(a);const o=flarum.core.compat["common/components/LoadingIndicator"];var l=e.n(o);const d=flarum.core.compat["common/components/Select"];var c=e.n(d);const u=flarum.core.compat["common/components/Button"];var h=e.n(u),g=function(e){function t(){return e.apply(this,arguments)||this}var n,a;a=e,(n=t).prototype=Object.create(a.prototype),n.prototype.constructor=n,i(n,a);var r=t.prototype;return r.oninit=function(t){e.prototype.oninit.call(this,t),this.loading={brands:!0,models:!1,years:!1,configs:!1,link:!1},this.brands=[],this.models=[],this.years=[],this.configs=[],this.link=null,this.selectedBrandId=null,this.selectedModelId=null,this.selectedYearId=null,this.selectedConfigId=null,this.currentStep=1,this.loadBrands()},r.view=function(){var e;return e=s().forum&&s().forum.attribute("canbus.promptText")?s().forum.attribute("canbus.promptText"):s().data&&s().data.settings&&s().data.settings["ltydi-canbus-settings.promptText"]?s().data.settings["ltydi-canbus-settings.promptText"]:'Please select the appropriate CANBUs type based on the actual product you received. To access the CANBUs settings, navigate to: Settings- Factory (enter "3368")→ Car Model.',m("div",{className:"CanBusPage"},m("div",{className:"container"},m("h2",null,"CanBus Settings"),m("p",null,e),m("p",{className:"SelectionOrder"},"Selection order: Car Brand → Car Model → Year Range → Configuration"),m("div",{className:"CanBusProgressBar"},m("div",{className:"CanBusProgressStep completed"},m("div",{className:"CanBusProgressDot"}),m("span",null,"Start")),m("div",{className:"CanBusProgressStep"+(this.selectedBrandId?" completed":"")},m("div",{className:"CanBusProgressDot"}),m("span",null,"Brand")),m("div",{className:"CanBusProgressStep"+(this.selectedModelId?" completed":"")},m("div",{className:"CanBusProgressDot"}),m("span",null,"Model")),m("div",{className:"CanBusProgressStep"+(this.selectedYearId?" completed":"")},m("div",{className:"CanBusProgressDot"}),m("span",null,"Year")),m("div",{className:"CanBusProgressStep"+(this.selectedConfigId?" completed":"")},m("div",{className:"CanBusProgressDot"}),m("span",null,"Config"))),m("div",{className:"CanBusSelectors-container"},m("div",{className:"Form-group"+(this.isCurrentStep("brand")?" active":"")},m("label",null,"Car Brand"),this.loading.brands?m(l(),null):m(c(),{value:this.selectedBrandId||"",options:this.getBrandOptions(),onchange:this.onBrandChange.bind(this)})),m("div",{className:"Form-group"+(this.isCurrentStep("model")?" active":"")},m("label",null,"Car Model"),this.loading.models?m(l(),null):m(c(),{value:this.selectedModelId||"",options:this.getModelOptions(),onchange:this.onModelChange.bind(this),disabled:!this.selectedBrandId}),!this.selectedBrandId&&m("small",{className:"SelectionHint"},"Please select a Car Brand first")),m("div",{className:"Form-group"+(this.isCurrentStep("year")?" active":"")},m("label",null,"Year Range"),this.loading.years?m(l(),null):m(c(),{value:this.selectedYearId||"",options:this.getYearOptions(),onchange:this.onYearChange.bind(this),disabled:!this.selectedModelId}),!this.selectedModelId&&m("small",{className:"SelectionHint"},"Please select a Car Model first")),m("div",{className:"Form-group"+(this.isCurrentStep("config")?" active":"")},m("label",null,"Configuration"),this.loading.configs?m(l(),null):m(c(),{value:this.selectedConfigId||"",options:this.getConfigOptions(),onchange:this.onConfigChange.bind(this),disabled:!this.selectedYearId}),!this.selectedYearId&&m("small",{className:"SelectionHint"},"Please select a Year Range first"))),this.loading.link?m(l(),null):this.link&&this.link.attributes&&this.link.attributes.url?this.renderLinkContent(this.link.attributes.url,this.link.attributes.description):this.selectedConfigId?m("div",{className:"alert alert-info",style:{margin:"30px 0",padding:"20px",borderRadius:"4px",display:"flex",alignItems:"center"}},m("i",{className:"fas fa-info-circle",style:{marginRight:"10px",fontSize:"24px",color:"#3176d9"}}),m("div",null,m("p",{style:{margin:"0",fontWeight:"bold"}},"No configuration image available for this selection."),m("p",{style:{margin:"5px 0 0 0"}},"Please try another configuration or contact support for assistance."))):null))},r.renderLinkContent=function(e,t){return m("div",{className:"CanBusContent",style:{marginTop:"30px",marginBottom:"30px"}},m("img",{src:this.getDirectDownloadUrl(e),alt:"CanBus Configuration",style:{width:"100%",height:"auto",display:"block",margin:"20px auto",maxHeight:"600px",objectFit:"contain",border:"1px solid #e9ecef",borderRadius:"4px"},onError:function(t){console.error("Image failed to load:",e),t.target.style.display="none";var n=document.createElement("div");n.className="alert alert-danger",n.style.margin="20px 0",n.innerHTML='\n              <p><i class="fas fa-exclamation-triangle"></i> '+s().translator.trans("ltydi-canbus-settings.forum.image_load_error")+"</p>\n              <p>"+s().translator.trans("ltydi-canbus-settings.forum.use_button_below")+"</p>\n            ",t.target.parentNode.insertBefore(n,t.target.nextSibling)}}),m("div",{style:{textAlign:"center",margin:"15px 0"}},m(h(),{className:"Button Button--primary",onclick:function(){return window.open(e,"_blank")},icon:"fas fa-external-link-alt"},"Open in New Window")),m("div",{className:"CanBusLinkDescription",style:{marginTop:"20px",padding:"15px",background:"#f8f9fa",border:"1px solid #e9ecef",borderRadius:"4px",color:"#495057",lineHeight:"1.5"}},m("i",{className:"fas fa-info-circle",style:{marginRight:"8px",color:"#3176d9",fontSize:"18px"}}),t||s().translator.trans("ltydi-canbus-settings.forum.no_additional_info")))},r.getBrandOptions=function(){var e={"":""};return this.brands&&this.brands.length&&this.brands.forEach((function(t){e[t.id]=t.attributes.name})),e},r.getModelOptions=function(){var e={"":""};return this.models&&this.models.length&&this.models.forEach((function(t){e[t.id]=t.attributes.name})),e},r.getYearOptions=function(){var e={"":""};return this.years&&this.years.length&&this.years.forEach((function(t){e[t.id]=t.attributes.year_range})),e},r.getConfigOptions=function(){var e={"":""};return this.configs&&this.configs.length&&this.configs.forEach((function(t){e[t.id]=t.attributes.name})),e},r.onBrandChange=function(e){var t=this;this.selectedBrandId=e||null,this.selectedModelId=null,this.selectedYearId=null,this.selectedConfigId=null,this.link=null,this.selectedBrandId?(this.selectedBrand=this.brands.find((function(e){return e.id===t.selectedBrandId})),this.loadModels()):(this.models=[],this.years=[],this.configs=[],m.redraw())},r.onModelChange=function(e){var t=this;this.selectedModelId=e||null,this.selectedYearId=null,this.selectedConfigId=null,this.link=null,this.selectedModelId?(this.selectedModel=this.models.find((function(e){return e.id===t.selectedModelId})),this.loadYears()):(this.years=[],this.configs=[],m.redraw())},r.onYearChange=function(e){var t=this;this.selectedYearId=e||null,this.selectedConfigId=null,this.link=null,this.selectedYearId?(this.selectedYear=this.years.find((function(e){return e.id===t.selectedYearId})),this.loadConfigs()):(this.configs=[],m.redraw())},r.onConfigChange=function(e){var t=this;this.selectedConfigId=e||null,this.selectedConfigId?(this.selectedConfig=this.configs.find((function(e){return e.id===t.selectedConfigId})),this.loadLink()):(this.link=null,m.redraw())},r.loadBrands=function(){var e=this;this.loading.brands=!0,s().request({method:"GET",url:s().forum.attribute("apiUrl")+"/canbus/brands"}).then((function(t){e.brands=t.data||[],e.loading.brands=!1,m.redraw()})).catch((function(t){console.error("Error loading brands:",t),e.loading.brands=!1,m.redraw()}))},r.loadModels=function(){var e=this;this.loading.models=!0,s().request({method:"GET",url:s().forum.attribute("apiUrl")+"/canbus/models",params:{"filter[brand_id]":this.selectedBrandId}}).then((function(t){t&&t.data?e.models=t.data:e.models=[],e.loading.models=!1,m.redraw()})).catch((function(t){console.error("Error loading models:",t),e.models=[],e.loading.models=!1,m.redraw()}))},r.loadYears=function(){var e=this;this.loading.years=!0,s().request({method:"GET",url:s().forum.attribute("apiUrl")+"/canbus/years",params:{"filter[model_id]":this.selectedModelId}}).then((function(t){e.years=t.data||[],e.loading.years=!1,m.redraw()})).catch((function(t){console.error("Error loading years:",t),e.years=[],e.loading.years=!1,m.redraw()}))},r.loadConfigs=function(){var e=this;this.loading.configs=!0,s().request({method:"GET",url:s().forum.attribute("apiUrl")+"/canbus/configs",params:{"filter[year_id]":this.selectedYearId}}).then((function(t){e.configs=t.data||[],e.loading.configs=!1,m.redraw()})).catch((function(t){console.error("Error loading configs:",t),e.configs=[],e.loading.configs=!1,m.redraw()}))},r.loadLink=function(){var e=this;this.loading.link=!0,s().request({method:"GET",url:s().forum.attribute("apiUrl")+"/canbus/links",params:{"filter[config_id]":this.selectedConfigId}}).then((function(t){t.data&&t.data.length>0?e.link=t.data[0]:e.link=null,e.loading.link=!1,m.redraw()})).catch((function(t){console.error("Error loading link:",t),e.link=null,e.loading.link=!1,m.redraw()}))},r.isCurrentStep=function(e){return"brand"===e?!this.selectedBrandId:"model"===e?this.selectedBrandId&&!this.selectedModelId:"year"===e?this.selectedModelId&&!this.selectedYearId:"config"===e&&this.selectedYearId&&!this.selectedConfigId},r.getDirectDownloadUrl=function(e){try{if(!e)return"";if(e.includes("drive.google.com")){var t=this.extractGoogleDriveFileId(e);return t?"https://drive.google.com/thumbnail?id="+t+"&sz=w1000":e}return e.startsWith("/")?(s().forum.attribute("baseUrl")||"")+e:e.startsWith("//")?"https:"+e:!e.match(/^https?:\/\//i)&&this.isImageUrl(e)?"https://"+e:e}catch(t){return console.error("Error processing download URL:",t),e}},r.extractGoogleDriveFileId=function(e){if(!e)return null;for(var t=0,n=[/\/d\/([a-zA-Z0-9_-]+)/,/id=([a-zA-Z0-9_-]+)/,/\/file\/d\/([a-zA-Z0-9_-]+)/,/drive\.google\.com\/open\?id=([a-zA-Z0-9_-]+)/];t<n.length;t++){var s=n[t],i=e.match(s);if(i)return i[1]}return null},r.isImageUrl=function(e){return!!e&&(!!e.includes("drive.google.com")||/\.(jpg|jpeg|png|gif|bmp|webp)$/i.test(e))},r.isGoogleDriveUrl=function(e){return!!e&&(e.includes("drive.google.com")||e.includes("docs.google.com"))},r.backToStep=function(e){this.currentStep=e,m.redraw()},t}(r());const f=flarum.core.compat["common/extend"],p=flarum.core.compat["forum/components/IndexPage"];var b=e.n(p);const v=flarum.core.compat["common/components/LinkButton"];var C=e.n(v);s().initializers.add("ltydi/canbus-settings",(function(){s().routes.canbus={path:"/canbus",component:g},(0,f.extend)(b().prototype,"navItems",(function(e){e.add("canbus-settings",m(C(),{icon:"fas fa-car",href:s().route("canbus")},"CanBus Settings"),85)}))}))})(),module.exports=t})();
//# sourceMappingURL=forum.js.map